## Веб версия Вангеров

Экслюзивные права на публикацию Вангеров в интренете принадлежать компании [GamePix](https://gamepix.com). Тем не менее
я [[@caiiiycuk](mailto:caiiiycuk@gmail.com)] являюсь разработчиком веб версии Вангеров. Поэтому хочу рассказать о некоторых
скрытых возможностях этой версии.

**Дисклеймер**: Все что написано на этом сайте, это мое личное менение и ни как не отражает/не связано с позицией компании GamePix.

Браузерная версия доступна по этим ссылкам:
* [GamePix Vangers](https://gamepix.com/play/vangers)
* [Yandex](https://yandex.ru/games/play/152268)

Любую обратную связь лучше отправлять в публичный [трекер](https://github.com/caiiiycuk/vangers-web/issues) проекта.

## Обзорное видео

<iframe width="560" height="315" src="https://www.youtube.com/embed/8z0AY2N9SLk" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

## Сетевой режим

Веб версия полностью поддерживает режим игры по сети, но он не включен по умолчанию. Этот режим является эксперементальным,
что бы им воспользоваться включите `Настройки -> Дополнения -> Сетевая Игра (Web)`. После этого вы сможете зайти или создать сетевую
игру, точно так же как и в обычной версии.

Для игры в браузере подойдет обычный сервер Вангеров. Однако, этот сервер должен уметь принимать `wss://` подключения.
[Инструкция по настройке сервера](https://github.com/KranX/Vangers/wiki/Starting-up-server-compatible-with-web-&-native-versions).

На данный момент только один сервер поддерживает веб версию `vangers.net`, для его использования **просто оставьте значение `auto` в
настройках игры**.

![auto](assets/net-auto.jpg)

Обычная версия Вангеров тоже может использовать этот сервер, для этого укажите адрес `vangers.net` в игре.
[Рукводство](https://dmitriy-tolkunov.medium.com/multiplayer-vangers-c6cd3b9bee0f) для новичков от `@W_DimON`.

## Модели выского разрешения

Вы можете включить модели выского разрешения созданные [@John Tomson](https://vk.com/jtttfwtd?w=wall-192086280_321), для этого используйте
соответствующий пункт настроек в экране дополнений.

**ВАЖНО**: Активация данного режима потребует значительно большего объема скачиваемы данных для старта игры (порядка 85Мб вместо 35Мб).

## Community eXperiemtns (Cx)

[Cx](https://github.com/Aidoneus/Vangers) - великолепный мод расширяющий возможности сетевой игры можно включить в экране дополнений. Участвуйте в покатушках [сообщества Вангеров](https://t.me/vangers), что бы насладится новыми сетевыми режимами этого мода.

И это ещё не ВСЁ! Cx позволяет запускать новые миры созданные в редакторах SurMap и SurWeb участниками сообщества. 


## SURWEB

SurWeb - редактор SurMap портированный в браузер. С его помощью вы можете создавать свои миры и сразу же тестировать их в веб версии. На данный
момент редактор не очень интуитивный, но я надеюсь что он будет развиваться.

[Редактор SurWeb](https://caiiiycuk.github.io/vangers-web/surweb/index.html)

[Инструкция](https://youtu.be/UPOkIhhQa1Q) по использованию редактора SurWeb от `@caiiiycuk`.

[Инструкция](https://youtu.be/YzZesk81SnQ) по использованию редактора SurMap от `@dilesoft`.

## Трюки

### Перенос сохранений с компьютера в браузер

Вангеры на gamepix поддерживают перенос сохранений из обычной версии игры, как это сделать описано в видео:

<iframe width="560" height="315" src="https://www.youtube.com/embed/W4MJ2rVdVHw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>


### Создание видео для магазина (новая версия)

Новая версия поддерживает воспроизведение видео в формате h264:yuv444p, что бы закодировать видео в этом формате достаточно выполнить комманду:

```
ffmpeg -i my_video.avi -c:v libx264 -vf format=yuv444p,scale=340x255 -an mech002.avi
```

Где:
* my_video.avi - видео которое вы хотите добавить в игру
* mech002.avi - видео из ресурсов игры которое вы хотите заменить

### Создание видео для магазина (старая версия)

Видео в магазине Вангеров имеет специальный формат:

```
Video: png (MPNG / 0x474E504D), pal8(pc), 340x255, 1422 kb/s, 15 fps, 15 tbr, 15 tbn, 15 tbc
```

По сути это последоватьельность индексированных PNG файлов размером 340x255px. Этот размер жёстко ограничен игрой, и любое не соотвествие приведет к падению. FPS не фиксирован и может быть любым (это влияет на размер файла).

Создать свое видео для магазина можно используя программу [ffmpeg](https://www.ffmpeg.org/). Скачайте и установите её.

Теперь подготовьте свое видео которое Вы будет конвертировать в формат Вангеров, соотношение сторон должно быть 
**4:3**, остальные параметры не важны.

Откройте папку с данными Вангеров и найдите видео *mech002.avi* (это первое видео в магазине). Сделайте его копию *mech002_backup.avi*.

Выполните команду ffmpeg в консоли (ffmpeg.exe в Windows):

```
ffmpeg -i myvideo.mp4 -i mech002_backup.avi -filter_complex "[1:v]palettegen=max_colors=125:reserve_transparent=0:transparency_color=0x000000:stats_mode=full[p],[p]drawbox=x=0:y=8:w=16:h=8:t=fill[b],[0:v]scale=340x255[s],[s][b]paletteuse=alpha_threshold=0" -c:v png -an mech002.avi
```

Всё, теперь файл *mech002.avi* содержит видео совместимое с Вангерами можете проверять!

А теперь подробнее, о файлах:
* myvideo.mp4 - это путь до видео которое нужно вставить в игру
* mecho002_backup.avi - это путь до видео из которго брать палитру. Совсем не обязательно использовать палитру игры, **вы можете указать здесь повторно исходное видео (myvideo.mp4)**.
* mech002.avi - результат преобразования

Как это работает:
* `[1:v]palettegen=max_colors=125:reserve_transparent=0:transparency_color=0x000000:stats_mode=full[p]` - фильтр генерации палитры из второго источника видео `[1:v]`, **количество цветов (max_colors) должно быть 125**, верхняя часть палитры зарезервированна для мигания. Сохраняем результат в `[p]`.
* `[p]drawbox=x=0:y=8:w=16:h=8:t=fill[b]` - закрашиваем верхнею часть палитры `[p]` (>=128) черным цветом. Это нужно что бы отбить желание у ffmpeg использовать цвета из этой части палитры, т.к. paletteuse не понимает что палитра состоит из 125 цветов а не 256. Сохраняем результат в `[b]`
* `[0:v]scale=340x255[s]` - изменяем размер первого источника видео до 340x255 и сохраняем результат в `[s]`.
* `[s][b]paletteuse=alpha_threshold=0` - берем уменьшенное видео `[s]` и применяем к нему палитру `[b]`.
* `-c:v png` - включаем PNG encoder
* `-an` - отбрасывем звук из видео