{"version":3,"sources":["config.ts","gen.tsx","zip.tsx","landing.tsx","router.tsx","index.tsx","xhr.ts","surweb.tsx","ron.tsx"],"names":["worldFile","palFile","vmpFile","vprFile","bitmapFolder","shapeFolder","Gen","props","useState","palette","setPalette","size","setSize","meshValue","setMeshValue","amplitude","setAmplitude","terainType","setTerainType","initialWorldIni","worldIni","setWorldIni","className","minimal","options","onChange","e","currentTarget","value","min","max","onValueChange","onClick","ini","openGen","large","growVertically","target","Zip","undefined","zipFile","setZipFile","busy","setBusy","a","readContents","zipContents","openZip","href","hasSelection","text","name","files","disabled","file","reader","FileReader","Promise","resolve","reject","addEventListener","event","Uint8Array","result","readAsArrayBuffer","Landing","opened","setOpened","Group","align","Alignment","LEFT","Heading","Divider","interactive","elevation","Elevation","TWO","intent","Intent","PRIMARY","openLastSession","isOpen","clearFs","width","height","src","title","frameBorder","allow","allowFullScreen","indexedDB","request","deleteDatabase","onsuccess","alert","onerror","ev","console","error","AppRouter","route","setRoute","gen","setGen","zip","setZip","setVmp","vmp","getVmp","length","ReactDOM","render","StrictMode","document","getElementById","resolveUrl","url","onProgress","XMLHttpRequest","open","overrideMimeType","evt","Error","responseType","onreadystatechange","readyState","status","response","onprogress","total","porgress","Math","round","loaded","send","WIDTH","HEIGHT","SurWeb","module","canvasRef","useRef","canvas","setCanvas","progress","setProgress","binaries","setBinaries","setLoaded","archiveUrl","setArchiveUrl","fileProgress","setFileProgress","setReader","ron","setRon","onArchive","archive","URL","revokeObjectURL","blob","Blob","type","createObjectURL","useEffect","all","dataJs","data","wasm","wasmJs","doLoad","catch","current","rect","parentElement","getBoundingClientRect","resizeCanvas","instantiateWasm","then","window","location","reload","onInputChange","focus","bytes","FS","root","cwd","endsWith","unlink","createDataFile","syncfs","err","onKeyDown","downloadUrl","onResize","contentRect","id","ref","tabIndex","lazy","hasBackdrop","Module","close","saveZip","info","receiveInstance","WebAssembly","compile","wasmModule","instantiate","instance","onRuntimeInitialized","instantiateProps","args","setTimeout","callMain","decoder","TextDecoder","Function","decode","moduleFn","chdir","FS_cwd","lookupPath","getPreloadedPackage","buffer","eval","m","enc","TextEncoder","encode","readFile","_clear_cwd","_malloc","HEAPU8","set","_zip_to_fs","_free","innerWidth","innerHeight","getSizeWithAspectRatio","style","position","top","left","marginTop","marginLeft","targetAspect","calculatedWidth","createElement","download","display","body","appendChild","click","remove","Ron","ronFile","setRonFile","heightFile","setHeightFile","hiFile","setHiFile","loFile","setLoFile","ronUrl","setRonUrl","heightUrl","setHeightUrl","hiUrl","setHiUrl","loUrl","setLoUrl","onFileChange","setFn","hi","lo","ron2vmp","_reloadWorld","_updateZipArchive","vpr","pal","vmp2ron","get_ron_multi_png","get_height_png","get_material_hi_png","get_material_lo_png","log","onInputCapture","icon","rel"],"mappings":"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","file":"static/js/main.59157f9b.chunk.js","sourcesContent":["export const worldFile = \"thechain/mirage/world.ini\";\nexport const palFile = \"thechain/mirage/harmony.pal\";\nexport const vmpFile = \"thechain/mirage/output.vmp\";\nexport const vprFile = \"thechain/mirage/output.vpr\";\nexport const bitmapFolder = \"bitmap/\";\nexport const shapeFolder = \"shape3d/\";","import {\n\tButton, Callout, HTMLSelect, NumericInput, TextArea\n} from '@blueprintjs/core';\nimport React, { useState } from 'react';\nimport \"./landing.css\";\nimport { AppProps } from './router';\n\nexport function Gen(props: AppProps) {\n\tconst [palette, setPalette] = useState<string>(\"mirage\");\n\tconst [size, setSize] = useState<number>(10);\n\tconst [meshValue, setMeshValue] = useState<number>(50);\n\tconst [amplitude, setAmplitude] = useState<number>(2);\n\tconst [terainType, setTerainType] = useState<number>(1);\n\tconst [worldIni, setWorldIni] = useState<string>(initialWorldIni);\n\n\tfunction openGen() {\n\t\tconst ini = `[Global Parameters]\nMap Power X=11\nMap Power Y=${size}\nGeoNet Power=6\nSection Size Power=8\nMinimal Square Power=4\n\n${worldIni}\n\n[Creation Parameters]\nBuild Scenario File=output.vsc\nMesh Value=${meshValue}\nNoise Amplitude=${amplitude}\nDefault Terrain Type=${terainType}\n`;\n\n\t\tprops.openGen(palette, ini, size)\n\t}\n\n\treturn <div>\n\t\t<div>\n\t\t\t<Callout>\n\t\t\t\t<h5>Generate World</h5>\n\t\t\t\t<p>Options</p>\n\t\t\t\t<div className=\"open-inputs\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label className=\"open-left-label\">Palette</label>\n\t\t\t\t\t\t<HTMLSelect minimal={false}\n\t\t\t\t\t\t\toptions={[\"ark-a-znoy\", \"boozeena\", \"fostral\", \"glorx\", \"hmok\", \"knox\", \"necross\", \"threall\", \"weexow\", \"xplo\", \"mirage\"]}\n\t\t\t\t\t\t\tonChange={(e) => setPalette(e.currentTarget.value)}\n\t\t\t\t\t\t\tvalue={palette} />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"in-a-row\">\n\t\t\t\t\t\t<label className=\"open-left-label\">World size ({size})</label>\n\t\t\t\t\t\t<NumericInput className=\"short-input\" min={10} max={14} value={size} onValueChange={setSize} />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"in-a-row\">\n\t\t\t\t\t\t<label className=\"open-left-label\">Mesh Value ({meshValue})</label>\n\t\t\t\t\t\t<NumericInput className=\"short-input\" min={1} max={200} value={meshValue} onValueChange={setMeshValue} />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"in-a-row\">\n\t\t\t\t\t\t<label className=\"open-left-label\">Noise Amplitude ({amplitude})</label>\n\t\t\t\t\t\t<NumericInput className=\"short-input\" min={1} max={10} value={amplitude} onValueChange={setAmplitude} />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"in-a-row\">\n\t\t\t\t\t\t<label className=\"open-left-label\">Terain Type ({terainType})</label>\n\t\t\t\t\t\t<NumericInput className=\"short-input\" min={0} max={7} value={terainType} onValueChange={setTerainType} />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Button onClick={openGen}>Generate World</Button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label className=\"open-left-label\">Additional params</label><br />\n\t\t\t\t\t\t<TextArea className=\"open-textarea\" large={false} growVertically={true} value={worldIni} onChange={(e) => setWorldIni(e.target.value)} />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</Callout>\n\t\t</div>\n\t</div>\n}\n\nconst initialWorldIni = `[Storage]\nVersion=1.4\nCompressed Format Using=0\nFile Name=output\nPalette File=harmony.pal\n\n[Rendering Parameters]\nShadow Offsets= 6 16 4 9 6 3 2 6\nHeight Shifts=  2 4 8 8 5 6 8 6\nBegin Colors=   1 32 64 72 88 104 112 120\nEnd Colors=    31 63 71 87 103 111 119 127\n\n[Dynamic Palette]\nWave Terrain=0\nTerrain Number=3\nTerrains= 5 4 6\nSpeeds= 128 128 256\nAmplitudes= 32 8 32\nRed= 1 1 1\nGreen= 0 1 1\nBlue= 0 0 0\n\n[Lighting Cycle Dynamic Palette]\nWave Terrain=0\nTerrain Number=3\nTerrains= 5 4 6\nSpeeds= 128 128 256\nAmplitudes= 32 8 32\nRed= 1 1 1\nGreen= 0 1 1\nBlue= 0 0 0\n`;","\nimport {\n\tButton, Callout, FileInput\n} from '@blueprintjs/core';\nimport React, { useState } from 'react';\nimport { AppProps } from \"./router\";\n\nexport function Zip(props: AppProps) {\n\tconst [zipFile, setZipFile] = useState<File | undefined>(undefined);\n\tconst [busy, setBusy] = useState<boolean>(false);\n\tfunction onFileChange(e: any) {\n\t\tsetZipFile(e.target.files[0]);\n\t}\n\n\tasync function restore() {\n\t\tif (zipFile === undefined || busy) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetBusy(true);\n\t\tconst zipContents = await readContents(zipFile);\n\t\tprops.openZip(zipContents);\n\t}\n\n\treturn <div>\n\t\t<Callout>\n\t\t\t<h5>Restore world from ZIP</h5>\n\t\t\t<ul>\n\t\t\t\t<li><a href=\"worlds/satadi.zip\">satadi.zip</a></li>\n\t\t\t\t<li><a href=\"worlds/empty.zip\">empty.zip</a></li>\n\t\t\t\t<li><a href=\"worlds/ark-a-znoy.zip\">ark-a-znoy.zip</a></li>\n\t\t\t\t<li><a href=\"worlds/boozeena.zip\">boozeena.zip</a></li>\n\t\t\t\t<li><a href=\"worlds/fostral.zip\">fostral.zip</a></li>\n\t\t\t\t<li><a href=\"worlds/glorx.zip\">glorx.zip</a></li>\n\t\t\t\t<li><a href=\"worlds/hmok.zip\">hmok.zip</a></li>\n\t\t\t\t<li><a href=\"worlds/khox.zip\">khox.zip</a></li>\n\t\t\t\t<li><a href=\"worlds/necross.zip\">necross.zip</a></li>\n\t\t\t\t<li><a href=\"worlds/threall.zip\">threall.zip</a></li>\n\t\t\t\t<li><a href=\"worlds/weexow.zip\">weexow.zip</a></li>\n\t\t\t\t<li><a href=\"worlds/xplo.zip\">xplo.zip</a></li>\n\t\t\t</ul>\n\t\t\t<div className=\"open-inputs\">\n\t\t\t\t<FileInput hasSelection={zipFile !== undefined} text={zipFile ? zipFile.name : \"Select 'zip' File\"}\n\t\t\t\t\tonChange={onFileChange} />\n\t\t\t\t<Button disabled={!zipFile || busy} onClick={restore}>Restore</Button>\n\t\t\t</div>\n\t\t</Callout>\n\t</div>;\n}\n\nasync function readContents(file: File) {\n\tconst reader = new FileReader();\n\n\treturn new Promise<Uint8Array>((resolve, reject) => {\n\t\treader.addEventListener('load', (event) => {\n\t\t\tresolve(new Uint8Array(reader.result as ArrayBuffer));\n\t\t})\n\t\treader.readAsArrayBuffer(file);\n\t})\n}","import {\n\tAlignment, AnchorButton, Button, Card, Collapse, Elevation, Intent, Navbar\n} from '@blueprintjs/core';\nimport React, { useState } from 'react';\nimport { Gen } from './gen';\nimport { Zip } from './zip';\nimport \"./landing.css\";\nimport { AppProps } from './router';\n\nexport function Landing(props: AppProps) {\n\tconst [opened, setOpened] = useState<string>(\"\");\n\n\treturn <div className=\"landing-menu\">\n\t\t<Navbar>\n\t\t\t<Navbar.Group align={Alignment.LEFT}>\n\t\t\t\t<Navbar.Heading>SurWeb</Navbar.Heading>\n\t\t\t\t<Navbar.Divider />\n\t\t\t\t<Navbar.Heading><a href=\"https://caiiiycuk.github.io/vangers-web/\">vangers-web</a></Navbar.Heading>\n\t\t\t</Navbar.Group>\n\t\t</Navbar>\n\t\t<Card className=\"root-card\" interactive={true} elevation={Elevation.TWO}>\n\t\t\t<div className=\"start-options\">\n\t\t\t\t<div className=\"open-option\">\n\t\t\t\t\t<AnchorButton minimal={true} intent={Intent.PRIMARY} onClick={() => props.openLastSession()}>Open SurWeb last session</AnchorButton>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"open-or\">\n\t\t\t\t\tOR\n\t\t\t\t</div>\n\t\t\t\t{\n\t\t\t\t\topened !== \"gen\" ?\n\t\t\t\t\t\t<div className=\"open-option\">\n\t\t\t\t\t\t\t<AnchorButton intent={Intent.PRIMARY} minimal={true} onClick={() => setOpened(\"zip\")}>Restore from ZIP</AnchorButton>\n\t\t\t\t\t\t</div> :\n\t\t\t\t\t\tnull\n\t\t\t\t}\n\t\t\t\t<Collapse isOpen={opened === \"zip\"}>\n\t\t\t\t\t<Zip {...props} />\n\t\t\t\t</Collapse>\n\t\t\t\t<div className=\"open-or\">\n\t\t\t\t\tOR\n\t\t\t\t</div>\n\t\t\t\t{\n\t\t\t\t\topened !== \"gen\" ?\n\t\t\t\t\t\t<div className=\"open-option\">\n\t\t\t\t\t\t\t<AnchorButton intent={Intent.PRIMARY} minimal={true} onClick={() => setOpened(\"gen\")}>Generate world</AnchorButton>\n\t\t\t\t\t\t</div> :\n\t\t\t\t\t\tnull\n\t\t\t\t}\n\t\t\t\t<Collapse isOpen={opened === \"gen\"}>\n\t\t\t\t\t<Gen {...props} />\n\t\t\t\t</Collapse>\n\t\t\t\t<div className=\"open-or\">\n\t\t\t\t\tADVANCED\n\t\t\t\t</div>\n\t\t\t\t<Button minimal={true} intent={Intent.PRIMARY} onClick={clearFs}>CLEAR SURWEB FS</Button>\n\t\t\t</div>\n\t\t\t<div className=\"tutorials\">\n\t\t\t\t<h1>Tutorials</h1>\n\t\t\t\t<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/YzZesk81SnQ\" title=\"YouTube video player\" frameBorder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowFullScreen={true}></iframe>\n\t\t\t\t<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/UPOkIhhQa1Q\" title=\"YouTube video player\" frameBorder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowFullScreen={true}></iframe>\n\t\t\t</div>\n\t\t</Card>\n\n\n\t</div>;\n}\n\nfunction clearFs() {\n\tif (typeof indexedDB === \"undefined\") {\n\t\talert(\"Unable to access indexedDB\");\n\t\treturn;\n\t}\n\n\tconst request = indexedDB.deleteDatabase(\"/idbfs\");\n\trequest.onsuccess = () => {\n\t\talert(\"Ok\");\n\t};\n\trequest.onerror = (ev) => {\n\t\talert(\"Error occured, look logs for details\");\n\t\tconsole.error(ev);\n\t}\n}","import React, { useState } from \"react\";\nimport { Landing } from \"./landing\";\nimport { SurWeb } from \"./surweb\";\n\n\nexport interface AppProps {\n\troute: string,\n\n\tgen: GenProps | null,\n\topenGen: (palette: string, worldIni: string, size: number) => void;\n\n\tzip: Uint8Array | null,\n\topenZip: (zip: Uint8Array) => void;\n\n\topenLastSession: () => void;\n\n\tgetVmp: () => Uint8Array | undefined;\n\tsetVmp: (vmp: Uint8Array) => void;\n}\n\nexport interface GenProps {\n\tpalette: string,\n\tworldIni: string,\n\tsize: number,\n}\n\nexport function AppRouter() {\n\tconst [route, setRoute] = useState<string>(\"\");\n\tconst [gen, setGen] = useState<GenProps|null>(null);\n\tconst [zip, setZip] = useState<Uint8Array|null>(null);\n\n\tconst props: AppProps = {\n\t\troute,\n\t\tgen,\n\t\topenGen: (palette: string, worldIni: string, size: number) => {\n\t\t\tsetGen({ palette, worldIni, size});\n\t\t\tsetRoute(\"gen\");\n\t\t},\n\t\tzip,\n\t\topenZip: (zip: Uint8Array) => {\n\t\t\tsetZip(zip);\n\t\t\tsetRoute(\"zip\");\n\t\t},\n\t\topenLastSession: () => {\n\t\t\tsetRoute(\"lastSession\");\n\t\t},\n\t\tsetVmp: (vmp: Uint8Array) => {},\n\t\tgetVmp: () => undefined,\n\t};\n\n\tif (route.length > 0) {\n\t\treturn <SurWeb {...props} />\n\t} else {\n\t\treturn <Landing {...props} />;\n\t}\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport \"@blueprintjs/core/lib/css/blueprint.css\";\n\nimport './index.css';\nimport { AppRouter } from './router';\n\nReactDOM.render(\n  <React.StrictMode>\n    <AppRouter />\n  </React.StrictMode>,\n  document.getElementById('root')\n);","export async function resolveUrl(url: string,\n                                 onProgress?: (progress: number) => void): Promise<Uint8Array> {\n    return new Promise<Uint8Array>((resolve, reject) => {\n        const request = new XMLHttpRequest();\n        request.open(\"GET\", url, true);\n        request.overrideMimeType(\"text/plain; charset=x-user-defined\");\n        request.addEventListener(\"error\", (evt) => {\n            reject(new Error(\"Network error, can't download \" + url));\n        });\n        request.addEventListener(\"abort\", () => {\n            reject(new Error(\"Request canceled for url \" + url));\n        }, false);\n        request.responseType = \"arraybuffer\";\n        request.onreadystatechange = () => {\n            if (request.readyState === 4) {\n                if (request.status === 200) {\n                    if (onProgress !== undefined) {\n                        onProgress(100);\n                    }\n                    resolve(new Uint8Array(request.response));\n                } else {\n                    reject(new Error(\"Network error, can't download \" + url));\n                }\n            }\n        };\n        if (onProgress !== undefined) {\n            request.onprogress = (event) => {\n                if (event.total && event.total > 0) {\n                    const porgress = Math.round(event.loaded * 10000 / event.total) / 100;\n                    onProgress(porgress);\n                }\n            }\n        }\n        request.send();\n    });\n}\n","import { Alignment, AnchorButton, Button, FileInput, Intent, Navbar, ResizeEntry, ResizeSensor, Spinner, Overlay } from \"@blueprintjs/core\";\nimport React, { useEffect, useRef, useState } from 'react';\nimport { Ron } from \"./ron\";\nimport { AppProps } from './router';\nimport './surweb.css';\nimport { resolveUrl } from './xhr';\nimport { worldFile, palFile, bitmapFolder, shapeFolder } from \"./config\";\n\n\nconst WIDTH = 1280;\nconst HEIGHT = 720;\n\ntype Binaries = { dataJs: Uint8Array, data: Uint8Array, wasm: Uint8Array, wasmJs: Uint8Array };\n\nexport function SurWeb(props: AppProps) {\n  const module = useState<any>({})[0];\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const [canvas, setCanvas] = useState<HTMLCanvasElement | null>(null);\n  const [progress, setProgress] = useState<number>(0);\n  const [binaries, setBinaries] = useState<Binaries | null>(null);\n  const [loaded, setLoaded] = useState<boolean>(false);\n  const [archiveUrl, setArchiveUrl] = useState<string | null>(null);\n  const [fileProgress, setFileProgress] = useState<number>(0);\n  const [reader, setReader] = useState<FileReader | null>(null);\n  const [ron, setRon] = useState<boolean>(false);\n\n  useEffect(() => {\n    async function doLoad() {\n      const [dataJs, data, wasm, wasmJs] = await Promise.all([\n        resolveUrl(\"surmap/bin.data.js\", setProgress),\n        resolveUrl(\"surmap/bin.data\", setProgress),\n        resolveUrl(\"surmap/surmap.wasm\"),\n        resolveUrl(\"surmap/surmap.js\")]);\n\n      setBinaries({ dataJs, data, wasm, wasmJs });\n    };\n\n    doLoad().catch(console.error);\n  }, []);\n\n  useEffect(() => {\n    if (canvasRef.current !== null) {\n      const canvas = canvasRef.current;\n      const rect = (canvas.parentElement as HTMLElement).getBoundingClientRect();\n      setCanvas(canvas);\n\n      canvas.width = WIDTH;\n      canvas.height = HEIGHT;\n      resizeCanvas(canvas, rect.width, rect.height);\n    }\n  }, [canvasRef]);\n\n  useEffect(() => {\n    if (canvas === null || binaries === null) {\n      return;\n    }\n\n    instantiateWasm(canvas, binaries, module, onArchive, props)\n      .then(() => setLoaded(true))\n      .catch(console.error);\n\n    // eslint-disable-next-line\n  }, [canvas, binaries, module]);\n\n  function onResize(e: ResizeEntry[]) {\n    if (canvas !== null) {\n      resizeCanvas(canvas, e[0].contentRect.width, e[0].contentRect.height);\n    }\n  }\n\n  function onArchive(archive: Uint8Array) {\n    if (archiveUrl !== null) {\n      URL.revokeObjectURL(archiveUrl);\n    }\n\n    const blob = new Blob([archive], {\n      type: \"application/zip\"\n    });\n    const url = URL.createObjectURL(blob);\n    setArchiveUrl(url);\n    // downloadUrl(url);\n  }\n\n  function onDownload() {\n    canvas?.focus();\n\n    if (archiveUrl !== null) {\n      downloadUrl(archiveUrl);\n    }\n  }\n\n  function onUpload(e: any) {\n    canvas?.focus();\n\n    const files = e.currentTarget.files as FileList;\n    if (files.length === 0) {\n      setReader(null);\n      return;\n    }\n\n    const file = files[0];\n    const reader = new FileReader();\n    reader.addEventListener(\"load\", async (e) => {\n      const bytes = new Uint8Array(reader.result as ArrayBuffer);\n      const FS = module.FS;\n      const root = FS.cwd() + \"/\";\n      if (file.name.endsWith(\".bmp\") || file.name.endsWith(\".pal\")) {\n        try {\n          FS.unlink(root + bitmapFolder + file.name);\n        } catch {\n          //\n        }\n        FS.createDataFile(root, bitmapFolder + file.name, bytes, true, true, true);\n        FS.syncfs((err: any) => { });\n        alert(\"Ok\");\n      } else if (file.name.endsWith(\".c3d\")) {\n        try {\n          FS.unlink(root + shapeFolder + file.name);\n        } catch {\n          //\n        }\n        FS.createDataFile(root, shapeFolder + file.name, bytes, true, true, true);\n        FS.syncfs((err: any) => { });\n        alert(\"Ok\");\n      } else {\n        alert(\"Only bmp / c3d / pal files are supported\");\n      }\n      setReader(null);\n    });\n    reader.addEventListener(\"progress\", (e) => setFileProgress(e.loaded / e.total));\n    reader.readAsArrayBuffer(file);\n    setReader(reader);\n  }\n\n  return (\n    <div className=\"surweb-container\">\n      <Navbar>\n        <Navbar.Group align={Alignment.LEFT}>\n          <Navbar.Heading><AnchorButton intent={Intent.PRIMARY} minimal={true} onClick={() => window.location.reload()}>SurWeb</AnchorButton></Navbar.Heading>\n          <Navbar.Divider />\n          {\n            loaded ?\n              <div className=\"file-container\">\n                <FileInput disabled={reader !== null} text=\"Add file\" onInputChange={onUpload} />\n                &nbsp;&nbsp;\n                <Spinner size={16} intent={Intent.PRIMARY} value={fileProgress} />\n              </div> :\n              <Navbar.Heading>Loading {progress}%</Navbar.Heading>\n          }\n          {loaded ?\n            <Button minimal={true} onKeyDown={() => { }} onClick={() => setRon(!ron)}>RON</Button> :\n            null\n          }\n          {\n            archiveUrl !== null ?\n              <Button intent={Intent.PRIMARY} onKeyDown={() => { }} minimal={true} onClick={onDownload}>Download ZIP</Button> :\n              null\n          }\n        </Navbar.Group>\n      </Navbar>\n      <ResizeSensor onResize={onResize}>\n        <div className=\"canvas-container\">\n          <canvas id=\"canvas\" ref={canvasRef} tabIndex={0}></canvas>\n          {loaded ? null : <div className=\"spinner-container\"><Spinner size={64} /></div>}\n        </div>\n      </ResizeSensor>\n      <Overlay isOpen={ron} lazy={true} hasBackdrop={false}>\n        <Ron {...props} Module={module} close={() => setRon(false)} />\n      </Overlay>\n    </div>\n  );\n}\n\nfunction instantiateWasm(canvas: HTMLCanvasElement,\n  binaries: Binaries,\n  Module: any,\n  onArchive: (archive: Uint8Array) => void,\n  props: AppProps) {\n  return new Promise<void>((resolve, reject) => {\n    try {\n      Module.saveZip = (archive: Uint8Array) => {\n        Module.FS.syncfs((err: any) => { });\n        onArchive(archive);\n      }\n      Module.canvas = canvas;\n      Module.instantiateWasm = async (info: any, receiveInstance: any) => {\n        const wasmModule = await WebAssembly.compile(binaries.wasm);\n        const instance = await WebAssembly.instantiate(wasmModule, info);\n        receiveInstance(instance, wasmModule);\n      };\n\n      Module.onRuntimeInitialized = () => {\n        instantiateProps(Module, props, binaries).then((args) => {\n          setTimeout(() => {\n            Module.callMain(args);\n            resolve();\n          }, 16);\n        }).catch(console.error);\n      };\n\n      const decoder = new TextDecoder();\n      const moduleFn = new (Function as any)([\"Module\"], decoder.decode(binaries.wasmJs));\n      moduleFn(Module);\n    } catch (e) {\n      reject(e);\n    }\n  });\n}\n\nfunction instantiateProps(Module: any, props: AppProps, binaries: Binaries): Promise<string[]> {\n  return new Promise<string[]>((resolve, reject) => {\n    Module.FS.chdir(\"/idbfs\");\n    Module.FS.syncfs(true, (err: any) => {\n      const root = Module.FS_cwd() + \"/\";\n\n      try {\n        Module.FS.lookupPath(root + worldFile);\n      } catch (e) {\n        // recreate FS\n        Module.getPreloadedPackage = (name: any, size: any) => binaries.data.buffer;\n        // eslint-disable-next-line\n        eval(new TextDecoder().decode(binaries.dataJs));\n        Module.FS.syncfs(() => { });\n      }\n\n      if (props.route === \"gen\" && props.gen !== null) {\n        (window as any).m = Module;\n        const enc = new TextEncoder();\n        Module.FS.unlink(root + worldFile);\n        Module.FS.createDataFile(root, worldFile, enc.encode(props.gen.worldIni), true, true, true);\n        if (props.gen.palette !== \"mirage\") {\n          Module.FS.unlink(root + palFile);\n          const data = Module.FS.readFile(root + \"_palette/\" + props.gen.palette + \".pal\");\n          Module.FS.createDataFile(root, palFile, data, true, true, true);\n        }\n        resolve([\"/I\" + props.gen.size, \"/G0\"]);\n      } else if (props.route === \"zip\" && props.zip !== null) {\n        Module.FS.chdir(root + \"thechain/mirage/\");\n        Module._clear_cwd();\n        const bytes = props.zip;\n        const buffer = Module._malloc(bytes.length);\n        Module.HEAPU8.set(bytes, buffer);\n        Module._zip_to_fs(buffer, bytes.length);\n        Module._free(buffer);\n        Module.FS.chdir(root);\n        resolve([]);\n      } else {\n        resolve([]);\n      }\n    });\n  });\n}\n\nfunction resizeCanvas(canvas: HTMLCanvasElement, innerWidth: number, innerHeight: number) {\n  const [width, height] = getSizeWithAspectRatio(innerWidth, innerHeight, WIDTH / HEIGHT);\n\n  canvas.style.position = \"relative\";\n  canvas.style.top = (innerHeight / 2) + \"px\";\n  canvas.style.left = (innerWidth / 2) + \"px\";\n  canvas.style.marginTop = (-1) * (height / 2) + \"px\";\n  canvas.style.marginLeft = (-1) * (width / 2) + \"px\";\n  canvas.style.width = width + \"px\";\n  canvas.style.height = height + \"px\";\n}\n\nfunction getSizeWithAspectRatio(width: number, height: number, targetAspect: number) {\n  const screenAspect = width / height;\n  if (screenAspect === targetAspect) {\n    return [width, height];\n  }\n  const calculatedWidth = Math.round(height * targetAspect);\n  if (calculatedWidth <= width) {\n    return [calculatedWidth, height];\n  }\n  const calculatedHeight = Math.round(width / targetAspect);\n  return [width, calculatedHeight];\n}\n\nfunction downloadUrl(url: string) {\n  const a = document.createElement(\"a\");\n  a.href = url;\n  a.download = \"world.zip\";\n  a.style.display = \"none\";\n  document.body.appendChild(a);\n\n  a.click();\n  a.remove();\n}","import {\n\tButton, Callout, FileInput, Spinner, Card, Icon\n} from '@blueprintjs/core';\nimport React, { useState } from 'react';\nimport { AppProps } from './router';\nimport { worldFile, palFile, vmpFile, vprFile } from \"./config\";\n\nimport \"./ron.css\";\n\ndeclare function ron2vmp(ron_multi_png: Uint8Array, height_png: Uint8Array, material_hi_png: Uint8Array, material_lo_png: Uint8Array): Uint8Array;\ndeclare function vmp2ron(ini: string, vmp: Uint8Array, vpr: Uint8Array, palette: Uint8Array): void;\ndeclare function get_ron_multi_png(): Uint8Array;\ndeclare function get_height_png(): Uint8Array;\ndeclare function get_material_hi_png(): Uint8Array;\ndeclare function get_material_lo_png(): Uint8Array;\n\nexport interface RonProps extends AppProps {\n\tModule: any;\n\tclose: () => void;\n}\n\nexport function Ron(props: RonProps) {\n\tconst [ronFile, setRonFile] = useState<File | undefined>(undefined);\n\tconst [heightFile, setHeightFile] = useState<File | undefined>(undefined);\n\tconst [hiFile, setHiFile] = useState<File | undefined>(undefined);\n\tconst [loFile, setLoFile] = useState<File | undefined>(undefined);\n\tconst [busy, setBusy] = useState<boolean>(false);\n\n\tconst [ronUrl, setRonUrl] = useState<string>(\"\");\n\tconst [heightUrl, setHeightUrl] = useState<string>(\"\");\n\tconst [hiUrl, setHiUrl] = useState<string>(\"\");\n\tconst [loUrl, setLoUrl] = useState<string>(\"\");\n\n\tfunction onFileChange(e: any, setFn: (f: File | undefined) => void) {\n\t\tsetFn(e.target.files[0]);\n\t}\n\n\tasync function updateWorld() {\n\t\tif (!(ronFile && heightFile && hiFile && loFile)) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetBusy(true);\n\t\tconst ron = await readContents(ronFile);\n\t\tconst height = await readContents(heightFile);\n\t\tconst hi = await readContents(hiFile);\n\t\tconst lo = await readContents(loFile);\n\t\tconst vmp = ron2vmp(ron, height, hi, lo);\n\n\t\tconst Module = props.Module;\n\t\tconst FS = Module.FS;\n\t\tconst root = FS.cwd() + \"/\";\n\t\tFS.unlink(root + vmpFile);\n\t\tFS.createDataFile(root, vmpFile, vmp, true, true, true);\n\t\tModule._reloadWorld();\n\t\tModule._updateZipArchive();\n\t\tsetBusy(false);\n\n\t\tprops.close();\n\t}\n\n\tasync function exportWorld() {\n\t\tsetBusy(true);\n\t\tsetTimeout(() => {\n\t\t\tconst Module = props.Module;\n\t\t\tconst FS = Module.FS;\n\n\t\t\tModule._updateZipArchive();\n\n\t\t\tconst root = FS.cwd() + \"/\";\n\t\t\tconst ini = new TextDecoder().decode(FS.readFile(root + worldFile));\n\t\t\tconst vmp = FS.readFile(root + vmpFile);\n\t\t\tconst vpr = FS.readFile(root + vprFile);\n\t\t\tconst pal = FS.readFile(root + palFile);\n\n\t\t\tvmp2ron(ini, vmp, vpr, pal);\n\n\t\t\tconst ron = get_ron_multi_png();\n\t\t\tconst height = get_height_png();\n\t\t\tconst hi = get_material_hi_png();\n\t\t\tconst lo = get_material_lo_png();\n\n\t\t\tif (ronUrl.length > 0) {\n\t\t\t\tURL.revokeObjectURL(ronUrl);\n\t\t\t\tURL.revokeObjectURL(heightUrl);\n\t\t\t\tURL.revokeObjectURL(hiUrl);\n\t\t\t\tURL.revokeObjectURL(loUrl);\n\t\t\t}\n\n\t\t\tsetRonUrl(URL.createObjectURL(new Blob([ron], { type: \"text\" })));\n\t\t\tsetHeightUrl(URL.createObjectURL(new Blob([height], { type: \"image/png\" })));\n\t\t\tsetHiUrl(URL.createObjectURL(new Blob([hi], { type: \"image/png\" })));\n\t\t\tsetLoUrl(URL.createObjectURL(new Blob([lo], { type: \"image/png\" })));\n\n\t\t\tconsole.log(ron, height, hi, lo);\n\t\t\tsetBusy(false);\n\t\t}, 100);\n\t}\n\n\treturn <Card>\n\t\t<div className=\"ron-container\">\n\t\t\t<div>\n\t\t\t\t{busy ?\n\t\t\t\t\t<Spinner /> :\n\t\t\t\t\t<Callout>\n\t\t\t\t\t\t<h5>Export WROLD to RON</h5>\n\t\t\t\t\t\t<div className=\"open-inputs\">\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tronUrl.length > 0 ?\n\t\t\t\t\t\t\t\t\t<Button className=\"ron-download\" onKeyDown={() => { }} minimal={true} onClick={() => downloadUrl(ronUrl, \"world.ron\")}>Download RON</Button> :\n\t\t\t\t\t\t\t\t\tnull\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\theightUrl.length > 0 ?\n\t\t\t\t\t\t\t\t\t<Button className=\"ron-download\" onKeyDown={() => { }} minimal={true} onClick={() => downloadUrl(heightUrl, \"height.png\")}>Download height PNG</Button> :\n\t\t\t\t\t\t\t\t\tnull\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\thiUrl.length > 0 ?\n\t\t\t\t\t\t\t\t\t<Button className=\"ron-download\" onKeyDown={() => { }} minimal={true} onClick={() => downloadUrl(hiUrl, \"material_hi.png\")}>Download material HI PNG</Button> :\n\t\t\t\t\t\t\t\t\tnull\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tloUrl.length > 0 ?\n\t\t\t\t\t\t\t\t\t<Button className=\"ron-download\" onKeyDown={() => { }} minimal={true} onClick={() => downloadUrl(loUrl, \"material_lo.png\")}>Download material LO PNG</Button> :\n\t\t\t\t\t\t\t\t\tnull\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t<Button onClick={exportWorld}>Export world</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</Callout>\n\t\t\t\t}\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t{busy ?\n\t\t\t\t\t<Spinner /> :\n\t\t\t\t\t<Callout>\n\t\t\t\t\t\t<h5>Update WORLD using RON</h5>\n\t\t\t\t\t\t<p>Provide files</p>\n\t\t\t\t\t\t<div className=\"open-inputs\">\n\t\t\t\t\t\t\t<FileInput hasSelection={ronFile !== undefined} text={ronFile ? ronFile.name : \"Select 'ron' File\"}\n\t\t\t\t\t\t\t\tonInputCapture={(e) => onFileChange(e, setRonFile)} />\n\t\t\t\t\t\t\t<FileInput hasSelection={heightFile !== undefined} text={heightFile ? heightFile.name : \"Select 'height' File\"}\n\t\t\t\t\t\t\t\tonInputCapture={(e) => onFileChange(e, setHeightFile)} />\n\t\t\t\t\t\t\t<FileInput hasSelection={hiFile !== undefined} text={hiFile ? hiFile.name : \"Select 'material_hi' File\"}\n\t\t\t\t\t\t\t\tonInputCapture={(e) => onFileChange(e, setHiFile)} />\n\t\t\t\t\t\t\t<FileInput hasSelection={loFile !== undefined} text={loFile ? loFile.name : \"Select 'material_lo' File\"}\n\t\t\t\t\t\t\t\tonInputCapture={(e) => onFileChange(e, setLoFile)} />\n\t\t\t\t\t\t\t<Button disabled={!(ronFile && heightFile && hiFile && loFile)} onClick={updateWorld}>Update world</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</Callout>\n\t\t\t\t}\n\t\t\t</div>\n\t\t\t<Icon className=\"ron-close\" icon=\"cross\" onClick={() => props.close()} />\n\t\t</div>\n\t\t<div className=\"ron-powered-by\">Powered by <a rel=\"noreferrer\" href=\"https://github.com/kvark/vange-rs/wiki/Resource-Converter\" target=\"_blank\">vanger-rs converter</a></div>\n\t</Card>\n}\n\nasync function readContents(file: File) {\n\tconst reader = new FileReader();\n\n\treturn new Promise<Uint8Array>((resolve, reject) => {\n\t\treader.addEventListener('load', (event) => {\n\t\t\tresolve(new Uint8Array(reader.result as ArrayBuffer));\n\t\t})\n\t\treader.readAsArrayBuffer(file);\n\t})\n}\n\nfunction downloadUrl(url: string, name: string) {\n\tconst a = document.createElement(\"a\");\n\ta.href = url;\n\ta.download = name;\n\ta.style.display = \"none\";\n\tdocument.body.appendChild(a);\n\n\ta.click();\n\ta.remove();\n}"],"sourceRoot":""}